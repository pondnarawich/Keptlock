<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kept-lock</title>

    <link rel="stylesheet" href="https://unpkg.com/swiper@7/swiper-bundle.min.css" />

    <!-- font awesome cdn link  -->
    <script src="https://kit.fontawesome.com/802ccae5cc.js" crossorigin="anonymous"></script>

    <!-- custom css file link  -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">

</head>

  
  
  <body id="navy">
    <header class="header">
  
      <a href="http://127.0.0.1:8000/keptlock/locker" class="logo"> Kept-lock </a>
                
       <div class="icons">
        <div>
          <p  class="logo"> {{username}} </p>
              <a href="http://127.0.0.1:8000/keptlock/user/logout" ><div class="fas fa-right-from-bracket" ></div></a>
        </div>
      </div>
    
    </header> 

    <!-- motto section starts  -->

    <section class="motto_small">
      <div class="image_small"> 
        <img src="https://cdn.discordapp.com/attachments/802176047096922175/957722877518544956/logo_prev_ui.png" alt="">
      </div>

      <div class="content_small">
          <h1>{{locker.name}}</h1>
      </div>

       <a class="icons" href="#change_name">
          <div class="fas fa-pencil"></div>
      </a>
    
    
    </section>

   
    
    <!-- motto section ends -->



   <section class="device">
      {% with messages = get_flashed_messages() %}
            {% if messages%}
                <div class="exists">
                    <h3> {{ messages[0] }}.</h3>
                </div>
            {% endif %}
            {% endwith %}

    <div class="locker" >
        <h2 class="heading"> Controller</h2>
        <div class="control">
          <div class="open">
            {% set count = namespace(value=0) %}
            {% for slot in slots %}
              {% set count.value = count.value + 1 %}
              {% if not slot.opened %}
                 <a class="button" href="#popup{{count.value}}"><div class="slot">
                  <h1>Open Slot #{{count.value}}</h1>
                </div></a>
              {% else %}
              {% if slot.opened%}
                  <a class="button"  disabled><div class="slot_no">
                  <h1>Slot #{{count.value}} is opened</h1>
                </div></a>
              {% endif %}
              {% endif %}
            {% endfor %}
          </div> 


        
        <div class="pin">
            <a onclick="location.href='http://127.0.0.1:8000/keptlock/locker/unlock/pin/{{lid}}';"><div class="box" >
              <div class="content"><h1>Generate Pin</h1></div>
              <div class="icons">  
                  <div class="fas fa-lock"></div>
              </div>
            </div></a>

          <div class="pin_his">

             <div class="pin_his_rec_cat">
              <h1>expiry date</h1>
              <h1>Expiry time</h1>
              <h1>Slot Number</h1>
              <h1>Pin-code</h1>
              <h1>Cancel</h1>
            </div>

            <div class="pin_his_box">
            {% if pins is not none %}
            {% for pin in pins %}
            <div class="pin_his_rec">
              <h1>{{ pin.date_end.strftime('%d-%m-%Y')}}</h1>
              <h1>{{ pin.date_end.strftime('%H:%M')}}</h1>
              <h1>{{ pin.slot}}</h1>
              <h1>{{ pin.code }}</h1>
              <form method="post"><input type="submit" value="Cancel" name="del_pin.{{pin.id}}" class="btn_pin"></form>
            </div>
            {% endfor %}
            {% else%}
              <div class="no_pin">
              No active pin
            </div>
            {% endif%}

            </div>
          </div>
        </div>
      </div>  

        <h2 class="heading"> History</h2>
        <div class="history">
            {% if histories is not none %}
           {% for his in histories %}
            <div class="his_rec">
              <h1>{{ his.date_time.strftime('%d-%m-%Y')}}</h1>
              <h1>{{ his.date_time.strftime('%H:%M')}}</h1>
              <h1>{{ his.slot}}</h1>
               <a onclick="location.href='http://127.0.0.1:8000//keptlock/locker/video/{{his.vid_id}}';">
                   <h3>Watch the video record</h3>
                   <div class="icons" ><div class="fas fa-circle-play"></div></div>
              </a>
            </div>
            {% endfor %}
             {% else%}
            <div class="his_rec">
              <h1>No history</h1>
            </div>
            {% endif%}
        </div>           
    </div>


  {% for slot in range(locker.size) %}
     <div id="popup{{slot}}" class="overlay">
      <div class="popup">
        <h2>Confirmation</h2>
        <div class="content">
          Are you sure, you want to unlock slot #{{slot+1}} ?
        </div>
          <form action="" method="post">
              <div class="button">
                  <input name="open.{{slot+1}}" type="submit" value="Confirm" class="btn_con">
                  <a href="#"class="btn_can">Cancel</a>
              </div>
          </form>
      </div>
    </div>
  {% endfor %}

   <div id="change_name" class="overlay">
      <div class="popup">
        <h2>Edit name</h2>
        <div class="content">
          Please enter a new name for your locker
        </div>
           <form action="" method="post">
            <input type="text" id="name"  name="name" placeholder="ex: my office locker"/>
              <div class="button">
                  <input name="change.name" type="submit" value="Confirm" class="btn_con">
                  <a href="#"class="btn_can">Cancel</a>
              </div>
          </form>
      </div>
    </div>

    </section> 
        
    
  </body>

</html>

